---
description:
globs:
alwaysApply: false
---
# 移动版开发规则

## 移动版架构

### 核心文件
- **移动版主页**: [frontend/mobile.html](mdc:frontend/mobile.html) - 移动端专用HTML结构
- **移动版样式**: [frontend/static/css/mobile.css](mdc:frontend/static/css/mobile.css) - 触摸优化的CSS样式
- **移动版脚本**: [frontend/static/js/mobile.js](mdc:frontend/static/js/mobile.js) - MobileDetectiveGame类和移动端逻辑

### 设备检测机制
- 自动检测移动设备并跳转到移动版
- 支持强制使用桌面版参数 `?desktop=1`
- 支持强制使用移动版参数 `?mobile=1`
- 设备检测函数在两个版本中都有实现

## 移动版特色功能

### 浮动操作按钮 (FAB)
- **角色按钮**: 显示角色选择器模态框
- **证据按钮**: 显示证据列表，带有数量徽章
- **笔记按钮**: 打开笔记编辑器
- **指控按钮**: 条件显示，需要足够证据
- **提示按钮**: 获取游戏提示
- **菜单按钮**: 游戏设置和导航

### 界面布局
- **顶部案情区**: 案例标题和进度信息
- **案情描述区**: 可展开/收起的详细描述
- **聊天容器**: 主要的对话显示区域
- **输入区域**: 问题输入和建议问题
- **浮动按钮**: 右下角的操作按钮组

### 模态框系统
- **角色选择器**: 网格布局的角色卡片
- **证据查看器**: 滚动列表显示所有证据
- **笔记编辑器**: 本地存储的笔记功能
- **指控界面**: 多步骤的指控流程
- **游戏菜单**: 重启、切换案例等选项

## 开发注意事项

### 触摸优化
- 所有按钮至少44px的触摸目标
- 防止意外缩放和双击缩放
- 支持触摸滑动和手势
- 适配安全区域（刘海屏）

### 响应式设计
- 使用viewport meta标签
- 禁用用户缩放 `user-scalable=no`
- 适配不同屏幕尺寸和方向
- 使用相对单位和弹性布局

### 性能优化
- 懒加载非关键资源
- 最小化DOM操作
- 使用CSS动画而非JavaScript动画
- 优化图片和字体加载

### API集成
- 与桌面版使用相同的后端API
- 正确处理流式响应
- 实现错误重试机制
- 维护会话状态

## 常见问题解决

### 设备检测问题
- 检查User-Agent字符串匹配
- 验证屏幕宽度检测逻辑
- 确保URL参数正确处理

### 布局问题
- 使用CSS Grid和Flexbox
- 测试不同设备和方向
- 检查安全区域适配

### 交互问题
- 验证触摸事件处理
- 测试模态框的打开/关闭
- 确保按钮状态正确更新

### API调用问题
- 检查移动版的API端点配置
- 验证请求格式和响应处理
- 确保错误处理机制正常

## 测试指南

### 浏览器测试
- Chrome DevTools设备模拟
- Safari响应式设计模式
- Firefox设备模拟器

### 真机测试
- iOS Safari浏览器
- Android Chrome浏览器
- 不同屏幕尺寸设备

### 功能测试
- 设备检测和自动跳转
- 所有浮动按钮功能
- 模态框交互
- 对话流程
- 证据收集
- 指控流程

## 维护建议

### 代码同步
- 保持移动版和桌面版API调用一致
- 同步游戏逻辑和状态管理
- 统一错误处理和用户反馈

### 样式维护
- 使用CSS变量管理主题色彩
- 保持设计系统一致性
- 定期检查不同设备的显示效果

### 功能更新
- 新功能优先考虑移动端体验
- 确保触摸交互的可用性
- 测试新功能在小屏幕上的表现
