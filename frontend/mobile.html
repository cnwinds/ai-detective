<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>🕵️ AI侦探推理游戏 - 手机版</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AI侦探">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="static/css/mobile.css" rel="stylesheet">
</head>
<body>
    <div id="mobile-app">
        <!-- 加载屏幕 -->
        <div class="mobile-screen" id="loading-screen">
            <div class="loading-container">
                <div class="loading-logo">🕵️</div>
                <div class="loading-text">
                    <h2>AI侦探推理</h2>
                    <p>正在加载游戏...</p>
                </div>
                <div class="loading-progress-bar">
                    <div class="loading-progress"></div>
                </div>
            </div>
        </div>

        <!-- 主菜单屏幕 -->
        <div class="mobile-screen active" id="main-menu">
            <div class="mobile-container">
                <!-- Logo区域 -->
                <div class="logo-section">
                    <div class="game-logo">🕵️</div>
                    <h1 class="game-title">AI侦探推理</h1>
                    <p class="game-subtitle">运用智慧解开谜团<br>体验沉浸式推理</p>
                </div>

                <!-- 数据展示 -->
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number">12+</div>
                        <div class="stat-label">精彩案例</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">AI</div>
                        <div class="stat-label">智能对话</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">∞</div>
                        <div class="stat-label">推理乐趣</div>
                    </div>
                </div>

                <!-- 特色功能 -->
                <div class="feature-list">
                    <div class="feature-item">
                        <i class="fas fa-brain"></i>
                        <span>AI驱动的智能角色对话系统</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-search"></i>
                        <span>多元化证据收集与分析</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-users"></i>
                        <span>丰富的角色背景故事</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-mobile-alt"></i>
                        <span>完美适配手机屏幕体验</span>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="action-buttons">
                    <button class="btn-mobile btn-primary" id="start-game-main-btn">
                        <i class="fas fa-play"></i>
                        <span>立即开始游戏</span>
                    </button>
                    <button class="btn-mobile btn-secondary" id="rules-btn">
                        <i class="fas fa-info-circle"></i>
                        <span>了解游戏规则</span>
                    </button>
                    <button class="btn-mobile btn-secondary" id="about-btn">
                        <i class="fas fa-question-circle"></i>
                        <span>关于游戏</span>
                    </button>
                </div>

                <!-- 使用提示 -->
                <div class="download-hint">
                    <p><i class="fas fa-lightbulb hint-icon"></i>建议添加到主屏幕，获得更好的游戏体验</p>
                    <p><i class="fas fa-wifi hint-icon"></i>需要网络连接以获得最佳AI对话体验</p>
                </div>

                <!-- 页面底部信息 -->
                <div class="footer-info">
                    <div id="mobile-version-info">AI Detective Game v1.0.0</div>
                </div>
            </div>
        </div>

        <!-- 案例选择页面 -->
        <div class="mobile-screen" id="case-selection">
            <div class="screen-header">
                <button class="back-btn" id="back-to-menu">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2>选择案例</h2>
                <div class="header-spacer"></div>
            </div>
            <div class="cases-container">
                <div class="cases-list" id="cases-list">
                    <!-- 案例列表将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 案情介绍页面 -->
        <div class="mobile-screen" id="case-intro-screen">
            <div class="intro-container">
                <!-- 案情内容区域 -->
                <div class="intro-content" id="intro-content">
                    <!-- 内容将通过JavaScript动态生成 -->
                </div>
                
                <!-- 底部固定按钮 -->
                <div class="intro-footer">
                    <button class="intro-btn skip-btn" id="skip-intro-btn">
                        <i class="fas fa-forward"></i>
                        跳过介绍
                    </button>
                    <button class="intro-btn start-btn" id="start-game-btn" disabled>
                        <i class="fas fa-play"></i>
                        开始游戏
                    </button>
                </div>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div class="mobile-screen" id="game-screen">
            <div class="game-container">
                <!-- 游戏头部 -->
                <div class="game-header">
                    <h2 id="game-case-title">案件标题</h2>
                    <div class="game-actions">
                        <button id="case-info-btn" class="header-btn">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <button id="menu-btn" class="header-btn">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 标签导航 -->
                <div class="tab-navigation">
                    <button class="tab-btn active" id="characters-tab">
                        <i class="fas fa-users"></i>
                        <span>角色</span>
                    </button>
                    <button class="tab-btn" id="chat-tab">
                        <i class="fas fa-comments"></i>
                        <span>对话</span>
                        <div class="unread-badge" id="unread-badge" style="display: none;">1</div>
                    </button>
                    <button class="tab-btn" id="evidence-tab">
                        <i class="fas fa-search"></i>
                        <span>证据</span>
                    </button>
                    <button class="tab-btn" id="notes-tab">
                        <i class="fas fa-sticky-note"></i>
                        <span>笔记</span>
                    </button>
                </div>
                
                <!-- 内容面板 -->
                <div class="content-panels">
                    <!-- 角色面板 -->
                    <div class="content-panel active" id="characters-panel">
                        <div class="panel-header">
                            <h3>相关人员</h3>
                            <div class="action-buttons">
                                <button id="get-hint-btn" class="action-btn">
                                    <i class="fas fa-lightbulb"></i>
                                    提示
                                </button>
                                <button id="make-accusation-btn" class="action-btn primary">
                                    <i class="fas fa-gavel"></i>
                                    指控
                                </button>
                            </div>
                        </div>
                        <div class="characters-grid" id="characters-grid">
                            <!-- 角色卡片将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 对话面板 -->
                    <div class="content-panel" id="chat-panel">
                        <div class="panel-header">
                            <h3 id="chat-character-name">选择角色开始对话</h3>
                            <button id="clear-chat-btn" class="action-btn">
                                <i class="fas fa-trash"></i>
                                清空
                            </button>
                        </div>
                        <div class="conversation-area" id="conversation-area">
                            <div class="welcome-message">
                                <i class="fas fa-comments"></i>
                                <p>选择一个角色开始询问</p>
                            </div>
                        </div>
                        <div class="question-input-area">
                            <div class="suggested-questions" id="suggested-questions" style="display: none;">
                                <div class="suggested-list" id="suggested-list">
                                    <!-- 推荐问题将动态生成 -->
                                </div>
                            </div>
                            <div class="input-area">
                                <textarea id="question-input" placeholder="输入你想问的问题..." rows="2"></textarea>
                                <button id="send-question-btn" class="send-btn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 证据面板 -->
                    <div class="content-panel" id="evidence-panel">
                        <div class="panel-header">
                            <h3>发现的证据</h3>
                        </div>
                        <div class="evidence-list" id="evidence-list">
                            <div class="no-evidence">
                                <i class="fas fa-search"></i>
                                <p>暂无发现的证据</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 笔记面板 -->
                    <div class="content-panel" id="notes-panel">
                        <div class="panel-header">
                            <h3>调查笔记</h3>
                            <button id="clear-notes-btn" class="action-btn">
                                <i class="fas fa-trash"></i>
                                清空
                            </button>
                        </div>
                        <div class="notes-area">
                            <textarea id="notes-area" placeholder="记录你的推理和发现..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PWA安装提示横幅 -->
    <div class="pwa-banner" id="pwaBanner">
        <span>🚀 安装到主屏幕，随时享受推理乐趣！</span>
        <button id="installBtn">安装</button>
        <button id="dismissBtn" style="background: transparent; border: 1px solid #ccc;">稍后</button>
    </div>

    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- 模态框 -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                内容
            </div>
        </div>
    </div>

    <!-- 消息提示 -->
    <div class="toast" id="toast">
        <i id="toast-icon" class="fas fa-info-circle"></i>
        <span id="toast-message">消息内容</span>
    </div>

    <!-- JavaScript -->
    <script src="static/js/mobile.js"></script>
    <script>
        // PWA安装功能
        let deferredPrompt;
        const pwaBanner = document.getElementById('pwaBanner');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');

        // 监听PWA安装提示事件
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // 检查是否已经安装或之前已拒绝
            if (!localStorage.getItem('pwa-dismissed')) {
                setTimeout(() => {
                    pwaBanner.classList.add('show');
                }, 2000);
            }
        });

        // 安装按钮点击事件
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('用户接受了PWA安装');
                } else {
                    console.log('用户拒绝了PWA安装');
                }
                
                deferredPrompt = null;
                pwaBanner.classList.remove('show');
            }
        });

        // 稍后按钮点击事件
        dismissBtn.addEventListener('click', () => {
            pwaBanner.classList.remove('show');
            localStorage.setItem('pwa-dismissed', 'true');
        });

        // PWA安装成功后隐藏横幅
        window.addEventListener('appinstalled', () => {
            pwaBanner.classList.remove('show');
            console.log('PWA安装成功');
        });
    </script>
</body>
</html> 