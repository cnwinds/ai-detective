<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>🕵️ AI侦探推理游戏 - 手机版</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AI侦探">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="static/css/mobile.css" rel="stylesheet">
</head>
<body>
    <div id="mobile-app">
        <!-- 加载屏幕 -->
        <div class="mobile-screen active" id="loading-screen">
            <div class="loading-container">
                <div class="loading-logo">🕵️</div>
                <div class="loading-text">
                    <h2>AI侦探推理</h2>
                    <p>正在加载游戏...</p>
                </div>
                <div class="loading-progress-bar">
                    <div class="loading-progress"></div>
                </div>
            </div>
        </div>

        <!-- 主菜单屏幕 -->
        <div class="mobile-screen" id="main-menu">
            <div class="mobile-container">
                <!-- Logo区域 -->
                <div class="logo-section">
                    <div class="game-logo">🕵️</div>
                    <h1 class="game-title">AI侦探推理</h1>
                    <p class="game-subtitle">运用智慧解开谜团<br>体验沉浸式推理</p>
                </div>

                <!-- 数据展示 -->
                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number">12+</div>
                        <div class="stat-label">精彩案例</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">AI</div>
                        <div class="stat-label">智能对话</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">∞</div>
                        <div class="stat-label">推理乐趣</div>
                    </div>
                </div>

                <!-- 特色功能 -->
                <div class="feature-list">
                    <div class="feature-item">
                        <i class="fas fa-brain"></i>
                        <span>AI驱动的智能角色对话系统</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-search"></i>
                        <span>多元化证据收集与分析</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-users"></i>
                        <span>丰富的角色背景故事</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-mobile-alt"></i>
                        <span>完美适配手机屏幕体验</span>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="action-buttons">
                    <button class="btn-mobile btn-primary" id="start-game-main-btn">
                        <i class="fas fa-play"></i>
                        <span>立即开始游戏</span>
                    </button>
                    <button class="btn-mobile btn-secondary" id="rules-btn">
                        <i class="fas fa-info-circle"></i>
                        <span>了解游戏规则</span>
                    </button>
                    <button class="btn-mobile btn-secondary" id="about-btn">
                        <i class="fas fa-question-circle"></i>
                        <span>关于游戏</span>
                    </button>
                </div>

                <!-- 使用提示 -->
                <div class="download-hint">
                    <p><i class="fas fa-lightbulb hint-icon"></i>建议添加到主屏幕，获得更好的游戏体验</p>
                    <p><i class="fas fa-wifi hint-icon"></i>需要网络连接以获得最佳AI对话体验</p>
                </div>

                <!-- 页面底部信息 -->
                <div class="footer-info">
                    <div id="mobile-version-info">AI Detective Game v1.0.0</div>
                </div>
            </div>
        </div>

        <!-- 案例选择页面 -->
        <div class="mobile-screen" id="case-selection">
            <div class="screen-header">
                <button class="back-btn" id="back-to-menu">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2>选择案例</h2>
                <div class="header-spacer"></div>
            </div>
            <div class="cases-container">
                <div class="cases-list" id="cases-list">
                    <!-- 案例列表将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 案情介绍页面 -->
        <div class="mobile-screen" id="case-intro-screen">
            <div class="intro-container">
                <!-- 案情内容区域 -->
                <div class="intro-content" id="intro-content">
                    <!-- 内容将通过JavaScript动态生成 -->
                </div>
                
                <!-- 底部固定按钮 -->
                <div class="intro-footer">
                    <button class="intro-btn skip-btn" id="skip-intro-btn">
                        <i class="fas fa-forward"></i>
                        跳过介绍
                    </button>
                    <button class="intro-btn start-btn" id="start-game-btn" disabled>
                        <i class="fas fa-play"></i>
                        开始游戏
                    </button>
                </div>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div class="mobile-screen" id="game-screen">
            <div class="game-layout">
                <!-- 左侧菜单按钮 -->
                <button class="sidebar-menu-btn" id="sidebar-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                
                <!-- 左侧滑出菜单 -->
                <div class="sidebar-menu" id="sidebar-menu">
                    <div class="menu-header">
                        <h3>游戏菜单</h3>
                        <button class="close-menu-btn" id="close-menu-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="menu-content">
                        <!-- 案件详情按钮 -->
                        <button class="menu-item" id="case-details-btn">
                            <i class="fas fa-info-circle"></i>
                            <span>案件详情</span>
                        </button>
                        
                        <!-- 其他功能 -->
                        <div class="menu-section">
                            <h4>其他功能</h4>
                            <button class="menu-item" id="evidence-menu-btn">
                                <i class="fas fa-search"></i>
                                <span>查看证据</span>
                            </button>
                            <button class="menu-item" id="notes-menu-btn">
                                <i class="fas fa-sticky-note"></i>
                                <span>调查笔记</span>
                            </button>
                            <button class="menu-item" id="get-hint-btn">
                                <i class="fas fa-lightbulb"></i>
                                <span>获取提示</span>
                            </button>
                            <button class="menu-item primary" id="make-accusation-btn">
                                <i class="fas fa-gavel"></i>
                                <span>进行指控</span>
                            </button>
                        </div>
                        
                        <!-- 角色列表 -->
                        <div class="menu-section">
                            <h4>对话角色</h4>
                            <div class="character-menu-list" id="character-menu-list">
                                <!-- 角色按钮将通过JavaScript动态生成 -->
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                <!-- 菜单遮罩 -->
                <div class="menu-overlay" id="menu-overlay"></div>
                
                <!-- 主内容区域 -->
                <div class="main-content">
                    <!-- 顶部案件标题 -->
                    <div class="case-title-header">
                        <h2 id="game-case-title">豪宅谋杀案</h2>
                    </div>
                    
                    <!-- 主要内容显示区域 -->
                    <div class="content-container">
                        <!-- 对话面板（主要显示区域） -->
                        <div class="chat-content" id="chat-content">
                            <div class="chat-header">
                                <h3 id="chat-character-name">选择角色开始对话</h3>
                            </div>
                            <div class="conversation-area" id="conversation-area">
                                <div class="welcome-message">
                                    <i class="fas fa-comments"></i>
                                    <p>从左侧菜单选择角色开始询问</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 模态内容区域（用于显示案件详情、证据等） -->
                        <div class="modal-content-area" id="modal-content-area" style="display: none;">
                            <div class="modal-header">
                                <h3 id="modal-content-title">内容标题</h3>
                                <button id="close-modal-content" class="close-btn">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-content-body" id="modal-content-body">
                                <!-- 动态内容 -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- 底部输入区域（仅对话时显示） -->
                    <div class="bottom-input" id="bottom-input" style="display: none;">
                        <div class="suggested-questions" id="suggested-questions" style="display: none;">
                            <div class="suggested-list" id="suggested-list">
                                <!-- 推荐问题将动态生成 -->
                            </div>
                        </div>
                        <div class="input-area">
                            <textarea id="question-input" placeholder="输入你想问的问题..." rows="2"></textarea>
                            <button id="send-question-btn" class="send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 指控界面 -->
        <div class="mobile-screen" id="accusation-screen">
            <div class="screen-header">
                <button class="back-btn" id="back-from-accusation">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2>进行指控</h2>
                <div class="header-spacer"></div>
            </div>
            <div class="accusation-container">
                <div class="accusation-form">
                    <div class="form-group">
                        <label for="mobile-accused-select">选择被指控者：</label>
                        <select id="mobile-accused-select" class="form-control">
                            <option value="">请选择...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="mobile-accusation-reasoning">指控理由：</label>
                        <textarea id="mobile-accusation-reasoning" class="form-control" rows="6" 
                                placeholder="详细说明你的指控理由和证据...&#10;&#10;例如：&#10;• 时间线矛盾&#10;• 证词不一致&#10;• 动机充分&#10;• 物理证据支持"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button id="mobile-submit-accusation-btn" class="btn-mobile btn-primary">
                            <i class="fas fa-gavel"></i>
                            <span>提交指控</span>
                        </button>
                        <button id="mobile-cancel-accusation-btn" class="btn-mobile btn-secondary">
                            <i class="fas fa-times"></i>
                            <span>取消</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 审判结果界面 -->
        <div class="mobile-screen" id="trial-result-screen">
            <div class="screen-header">
                <h2><i class="fas fa-balance-scale"></i> 审判结果</h2>
                <button class="header-action-btn" id="trial-menu-btn">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
            <div class="trial-container">
                <div id="mobile-trial-result-content" class="trial-result-content">
                    <!-- 审判结果将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- PWA安装提示横幅 -->
    <div class="pwa-banner" id="pwaBanner">
        <span>🚀 安装到主屏幕，随时享受推理乐趣！</span>
        <button id="installBtn">安装</button>
        <button id="dismissBtn" style="background: transparent; border: 1px solid var(--theme-border-color);">稍后</button>
    </div>

    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- 模态框 -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                内容
            </div>
        </div>
    </div>

    <!-- 消息提示 -->
    <div class="toast" id="toast">
        <i id="toast-icon" class="fas fa-info-circle"></i>
        <span id="toast-message">消息内容</span>
    </div>

    <!-- 主题系统脚本 - 必须在应用程序脚本之前加载 -->
    <script src="static/js/theme-manager.js"></script>
    <script src="static/js/theme-selector.js"></script>
    
    <!-- JavaScript -->
    <script src="static/js/mobile.js"></script>
    
    <script>
        // 初始化主题选择器触发按钮
        document.addEventListener('DOMContentLoaded', () => {
            // 等待主题管理器加载完成后创建触发按钮
            if (window.themeSelector) {
                window.themeSelector.createTriggerButton();
            }
        });
        
        // PWA安装横幅逻辑
        let deferredPrompt;
        const pwaBanner = document.getElementById('pwa-banner');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');

        // 监听PWA安装提示事件
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // 检查是否已经安装或之前已拒绝
            if (!localStorage.getItem('pwa-dismissed')) {
                setTimeout(() => {
                    pwaBanner.classList.add('show');
                }, 2000);
            }
        });

        // 安装按钮点击事件
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('用户接受了PWA安装');
                } else {
                    console.log('用户拒绝了PWA安装');
                }
                
                deferredPrompt = null;
                pwaBanner.classList.remove('show');
            }
        });

        // 稍后按钮点击事件
        dismissBtn.addEventListener('click', () => {
            pwaBanner.classList.remove('show');
            localStorage.setItem('pwa-dismissed', 'true');
        });

        // PWA安装成功后隐藏横幅
        window.addEventListener('appinstalled', () => {
            pwaBanner.classList.remove('show');
            console.log('PWA安装成功');
        });
    </script>
</body>
</html>